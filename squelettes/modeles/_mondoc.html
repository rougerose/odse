<BOUCLE_doc(DOCUMENTS){id_document}{tout}>
  [(#REM)

    Modele CONSTANT pour <doc> en <figure>

    La largeur du titre est egale a la largeur de la vignette,
    avec un minimum de 120px et un maximum de 350px.

  ]

  [(#SET{fichier,[(#LOGO_DOCUMENT)]})]
  [(#SET{url,#ENV{lien,#URL_DOCUMENT}})]
  [(#SET{titre,[(#TITRE|sinon{[(#FICHIER|basename)]})]})]
  [(#SET{title,[(#GET{titre}|couper{80})][ (#MODELE{info_document})]})]
  [(#SET{alt,[(#GET{title})]})]
  [(#SET{lien_class, #VAL{c-doc-emb__link}|concat{#ENV{lien_class}}})]

  [(#REM)

    Dans le cas d'une simple image, on affiche sa vignette,
    avec lien vers la version originale, si elle est plus grande.

  ]
  [(#EXTENSION|match{jpg|gif|png}|oui)
    [(#SET{fichier,[(#FICHIER|image_reduire{#CONFIG{taille_preview,150}})]})]
    [(#SET{titre,''})]
    [(#LARGEUR|>{#CONFIG{taille_preview,150}}|?{
      [(#SET{url,#URL_DOCUMENT})]
      [(#SET{title,[(#TITRE|sinon{[(#FICHIER|basename)]}|couper{80})]})]
      [(#SET{alt,[(#GET{title})]})]
    ,
      [(#SET{url,''})]
      [(#SET{title,''})]
      [(#SET{alt,[(#TITRE|couper{60})]})]
    })]
  ]

  #SET{width,#GET{fichier}|largeur}
  #SET{height,#GET{fichier}|hauteur}
  #SET{fichier,#GET{fichier}|extraire_attribut{src}}

  <figure class="spip_document_#ID_DOCUMENT spip_documents[ spip_documents_(#ENV{align})] c-doc-emb[ c-doc-emb--(#ENV{align})][ (#ENV{class})] spip_lien_ok"[ style='float:(#ENV{align}|match{left|right});']>
    [<a href="(#ENV{lien,#GET{url}})"[(#ENV{lien}|non) type="#MIME_TYPE"][ (#DISTANT|oui)rel="external"][ class="(#GET{lien_class})"]>]<img src='#GET{fichier}' width='#GET{width}' height='#GET{height}'[ alt="(#GET{alt}|attribut_html)"][(#GET{url}|oui)[ title="(#GET{title}|attribut_html)"]] class="c-doc-emb__img" />[(#ENV{lien,#GET{url}}|?{</a>})]
    [<figcaption class="c-doc-emb__caption">
      <p class="c-doc-emb__title">(#TITRE)</p>
      [(#DESCRIPTIF|ou{#CREDITS}|oui)<p class="c-doc-emb__desc">[(#DESCRIPTIF|PtoBR)][ <span class="c-doc-emb__credits">(#CREDITS)</span>]</p>]
    </figcaption>]
  </figure>
</BOUCLE_doc>
